(window["webpackJsonpcomdirect-to-ynab"]=window["webpackJsonpcomdirect-to-ynab"]||[]).push([[0],{19:function(e,t,n){e.exports=n(43)},24:function(e,t,n){},43:function(e,t,n){"use strict";n.r(t);var r=n(0),c=n.n(r),a=n(9),u=n.n(a);n(24),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var o=n(6),i=n(2),s=n(5),l=n(4),f="YNAB_SET_ACCESS_TOKEN",d="YNAB_LOGIN",p="YNAB_LOGIN_PENDING",m="YNAB_LOAD_BUDGET",g="YNAB_SET_BUDGETS",b="YNAB_SEND_TRANSACTIONS",v="YNAB_ADD_IMPORT_RESULT";function h(e){return{type:f,accessToken:e}}function y(e){return{type:p,loginPending:e}}var O="IMPORT_FINISHED";function w(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function E(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?w(n,!0).forEach((function(t){Object(l.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):w(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function j(e){return e.accessToken}function P(e){return e.loginPending}function N(e){return e.budgets}function S(e){return{successful:e.successful,result:e.result,budget:e.budget}}var A="CSV_ADD_ACCOUNTS";function D(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _(e,t){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?D(n,!0).forEach((function(t){Object(l.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):D(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e,{accounts:[].concat(Object(s.a)(e.accounts),Object(s.a)(t))})}var T="ADD_MAPPING";var x=n(16),k=n(18),B=function(e){return e.map},C=function(e){return e.csv.accounts},R=function(e,t){return C(e).find((function(e){return e.id===t}))};function I(e,t){return t.budgets.getBudgets().then((function(n){var r=n.data.budgets;Promise.all(r.map((function(e){return t.accounts.getAccounts(e.id)}))).then((function(t){t.forEach((function(e,t){return r[t].accounts=e.data.accounts.filter((function(e){return!e.closed}))})),e(function(e){return{type:g,budgets:e}}(r))}))}))}function U(e,t){return e[t]||(e[t]={id:t,accounts:[]}),e[t]}function L(e){return parseInt((1e3*e).toFixed(0))}function Y(e,t,n){var r=[],c=!0,a=!1,u=void 0;try{for(var o,i=function(){var e=o.value;R(t,e.csv).transactions.map((function(t){return function(e,t,n){var r,c=n.filter((function(t){return t.valueDate.getTime()===e.valueDate.getTime()&&t.value===e.value})).length;return n.push(e),{account_id:t,date:e.valueDate,amount:L(e.value),payee_name:(r=e.payee.name,null===r||r.length<=50?r:r.substr(0,50)),memo:e.text,cleared:"cleared",import_id:"comdirect:".concat(L(e.value),":").concat(e.valueDate.toISOString().substr(0,10),":").concat(c)}}(t,e.ynab,n)})).forEach((function(e){return r.push(e)}))},s=e[Symbol.iterator]();!(c=(o=s.next()).done);c=!0)i()}catch(l){a=!0,u=l}finally{try{c||null==s.return||s.return()}finally{if(a)throw u}}return r}function G(e,t,n){var r=function(e){var t={};for(var n in e){if(e[n].account)U(t,e[n].budget).accounts.push({csv:n,ynab:e[n].account})}return t}(B(e)),c=[],a=[],u=function(u){var o=Y(r[u].accounts,e,c),i=t.transactions.createTransactions(u,{transactions:o}).then((function(e){return n(function(e,t){return{type:v,budget:e,result:t,successful:!0}}(u,e))}));a.push(i)};for(var o in r)u(o);Promise.all(a).then((function(){return n({type:O})}))}var F=function(e){return e.ynab.accessToken},M=function(e){return e.ynab.loginPending},V=function(e){return e.ynab.budgets},Z=function(e){return e.ynab.importFinished},K=function(e){return e.ynab.importResults},z=(n(37),n(40),"https://app.youneedabudget.com/oauth/authorize?client_id=".concat("dae768ce4e0279d3d9f7721f0828630c72a16189ffc68ce9b1087ababb37a6f0","&redirect_uri=").concat(window.location.href,"&response_type=token")),H=Object(i.b)((function(e){return{accessToken:F(e),loginPending:M(e),onClick:function(){return window.location.href=z}}}))((function(e){var t=e.accessToken,n=e.loginPending,r=e.onClick;if(t)return null;var a=n?"Logging in ...":"Login with YNAB";return c.a.createElement("button",{type:"button",className:"btn btn-primary text",onClick:r,disabled:n},a)})),J=n(8),W=/ Auftraggeber: (.+)Buchungstext: (.+) Ref\. (.+) /;var X={parse:function(e){var t=W.exec(e);return{payee:{name:t[1]},text:t[2],reference:t[3]}},canParse:function(e){return W.test(e)}},$=/ (Empf\xe4nger|Auftraggeber): (.+)Kto\/IBAN: (\w+) BLZ\/BIC: (\w+)( Buchungstext: (.+))? Ref\. (.+)/;var q={parse:function(e){var t=$.exec(e);return{payee:{name:t[2],iban:t[3],bic:t[4]},text:t[6],reference:t[7]}},canParse:function(e){return $.test(e)}},Q=/ Buchungstext: (.+) Ref\. (.+) /;var ee={parse:function(e){var t=Q.exec(e);return{payee:{name:null},text:t[1],reference:t[2]}},canParse:function(e){return Q.test(e)}},te=/ Empf\xe4nger: (.+)Buchungstext: ((\d+) Ueberweisung von Girokonto auf Visa-Karte) Ref\. (.+) /;var ne={parse:function(e){var t=te.exec(e);return{payee:{name:t[1],creditCardNo:t[3]},text:t[2],reference:t[4]}},canParse:function(e){return te.test(e)}},re=/ (.+[^A-Z])[A-Z].+?\d\d\d/;var ce={parse:function(e){return{payee:{name:re.exec(e)[1].trim()}}},canParse:function(e){return re.test(e)}},ae=/ \d\.\d\d PROZ.AUSLANDSENTGELT /;var ue={parse:function(e){return{payee:{name:"comdirect"},text:e}},canParse:function(e){return ae.test(e)}},oe=/ SUMME MONATSABRECHNUNG VISA /;var ie={parse:function(e){return{payee:{name:"Visa"}}},canParse:function(e){return oe.test(e)}},se=/ UEBERTRAG AUF VISA-KARTE /;var le={parse:function(e){return{payee:{name:"Self"},text:e}},canParse:function(e){return se.test(e)}},fe=n(17),de=n.n(fe);function pe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var me=/"Ums\xe4tze (.+) ";"Zeitraum: ([\d])+ Tage";/,ge=/"([\d]{2}.[\d]{2}.[\d]{4})";"([\d]{2}.[\d]{2}.[\d]{4})";"([^"]*)";("([^"]*)";)?"([^"]*)";"(-?[\d.,]+)";/,be=/([\d]{2}).([\d]{2}).([\d]{4})/,ve=3,he=2,ye=1,Oe=1,we=2,Ee=3,je=6,Pe=7;function Ne(e){var t=be.exec(e);return new Date(t[ve],t[he]-1,t[ye],12)}var Se=[q,X,ee,ne,ce,ue,ie,le];function Ae(e){var t,n=ge.exec(e);return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?pe(n,!0).forEach((function(t){Object(l.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):pe(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({valueDate:Ne(n[Oe]),bookingDate:Ne(n[we]),process:n[Ee],value:(t=n[Pe],t=(t=t.replace(/\./g,"")).replace(",","."),parseFloat(t))},function(e){var t=Se.find((function(t){return t.canParse(e)}));if(!t)throw new Error("Cannot parse text ".concat(e));return t.parse(e)}(n[je]))}function De(e){var t=[];return(e=e.replace(/\r\n"neu";/g,"")).split("\r\n").forEach((function(e,n){if(function(e,t){return 0===e&&";"!==t&&""!==t.trim()}(n,e))throw new Error("Unexpected file format");!function(e){return me.test(e)}(e)?function(e){return ge.test(e)}(e)&&t[t.length-1].transactions.push(Ae(e)):t.push(function(e){return{name:me.exec(e)[1],id:de()(),transactions:[]}}(e))})),t.filter((function(e){return e.transactions.length>0}))}function _e(e){return new Promise((function(t){var n=new FileReader;n.addEventListener("load",(function(){t(De(n.result))})),n.readAsText(e,"cp1252")}))}function Te(e){return e?"black":"grey"}function xe(e){return function(t){t.preventDefault(),e()}}var ke=function(e){var t=e.addAccounts,n=Object(r.useState)(!1),a=Object(J.a)(n,2),u=a[0],o=a[1];return c.a.createElement("div",{style:{border:"2px dashed ".concat(Te(u)),minHeight:"100px"},className:"d-flex align-items-center justify-content-center",onDragOver:xe((function(){return o(!0)})),onDragLeave:xe((function(){return o(!1)})),onDrop:function(e){e.preventDefault(),o(!1),function(e){for(var t=[],n=0;n<e.length;n++)t.push(_e(e[n]));return Promise.all(t).then((function(e){return e.reduce((function(e,t){return[].concat(Object(s.a)(e),Object(s.a)(t))}),[])}))}(e.dataTransfer.files).then((function(e){t(e)})).catch((function(e){return console.log(e)}))}},"Drop CSV file here")};var Be=Object(i.b)(null,(function(e){return{addAccounts:function(t){return e(function(e){return{type:A,accounts:e}}(t))}}}))(ke);var Ce=function(e){var t=e.account,n=e.budgets,a=e.addMapping,u=Object(r.useState)(n[0]),o=Object(J.a)(u,2),i=o[0],s=o[1],f=Object(r.useState)(null),d=Object(J.a)(f,2),p=d[0],m=d[1];return Object(r.useEffect)((function(){a(Object(l.a)({},t.id,{account:p?p.id:null,budget:i.id}))}),[i,p]),c.a.createElement("div",{className:"row"},c.a.createElement("div",{className:"col"},t.name),c.a.createElement("div",{className:"col form-group"},c.a.createElement("label",null,"Budget",c.a.createElement("select",{className:"form-control",id:"exampleFormControlSelect1",onChange:function(e){var t=e.target.value,r=n.find((function(e){return e.id===t}));s(r),m(null)},value:i.id},n.map((function(e){return c.a.createElement("option",{value:e.id,key:e.id},e.name)}))))),c.a.createElement("div",{className:"col form-group"},c.a.createElement("label",null,"Account",c.a.createElement("select",{className:"form-control",id:"exampleFormControlSelect1",value:p?p.id:"-",onChange:function(e){var t=e.target.value;if("-"!==t){var n=i.accounts.find((function(e){return e.id===t}));m(n)}else m(null)}},c.a.createElement("option",{value:"-"},"-"),i.accounts.map((function(e){return c.a.createElement("option",{value:e.id,key:e.id},e.name)}))))))};var Re=Object(i.b)((function(e){return{budgets:V(e)}}),(function(e){return{addMapping:function(t){return e(function(e){return{type:T,mapping:e}}(t))}}}))(Ce);var Ie=function(e){var t=e.sendToYNAB;return c.a.createElement("button",{type:"button",className:"btn btn-primary text",onClick:t},"Send to YNAB")};var Ue=Object(i.b)(null,(function(e){return{sendToYNAB:function(){return e({type:b})}}}))(Ie);var Le=function(e){var t=e.accounts,n=e.results,r=e.showCSVDropZone,a=e.showAccounts,u=e.showResults,o=e.getBudget;return c.a.createElement("div",{className:"container"},c.a.createElement("h1",{className:"text-center"},"Comdirect YNAB Transaction Import"),c.a.createElement("div",{className:"text-center"},c.a.createElement(H,null)),r?c.a.createElement(Be,null):null,t.map((function(e){return c.a.createElement(Re,{account:e})})),a?c.a.createElement("div",{className:"text-right"},c.a.createElement(Ue,null)):null,u?c.a.createElement("ul",null,n.map((function(e,t){return c.a.createElement("li",{key:t},o(e.budget).name," - successful: ",e.successful?"yes":"no"," - new transactions: ",e.result.data.transaction_ids.length," - ignored transactions: ",e.result.data.duplicate_import_ids.length)}))):null)},Ye=Object(i.b)((function(e){return{accessToken:F(e),accounts:C(e),results:K(e),getBudget:function(t){return function(e,t){return e.ynab.budgets.find((function(e){return e.id===t}))}(e,t)},showAccounts:C(e).length>0&&!Z(e),showCSVDropZone:F(e)&&0===C(e).length&&!Z(e),showResults:Z(e)}}))(Le),Ge=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||o.d,Fe=Object(o.e)(Object(o.c)({ynab:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{importResults:[]},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case f:return E({},e,{accessToken:j(t)});case p:return E({},e,{loginPending:P(t)});case g:return E({},e,{budgets:N(t)});case v:return E({},e,{importResults:[].concat(Object(s.a)(e.importResults),[S(t)])});case O:return E({},e,{importFinished:!0});default:return e}},csv:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{accounts:[]},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case A:return _(e,t.accounts);case O:return{accounts:[]};default:return e}},map:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case T:return Object.assign({},e,t.mapping);default:return e}}}),Ge(Object(o.a)(x.a,(function(e){var t,n=e.dispatch,r=e.getState;return function(e){return function(c){switch(c.type){case d:return function(e,t){e(y(!0));var n=new k.a(t);return n.user.getUser().then((function(){return e(h(t)),e(y(!1)),n})).catch((function(){return e(h(null)),e(y(!1)),null}))}(n,c.accessToken).then((function(e){t=e}));case m:return I(n,t);case b:return G(r(),t,n);default:return e(c)}}}})))),Me=/#access_token=([a-z0-9-]+)/;window.location.hash&&Me.test(window.location.hash)&&sessionStorage.setItem("access_token",window.location.hash.match(Me)[1]);var Ve,Ze=sessionStorage.getItem("access_token");Fe.dispatch((Ve=Ze,{type:d,accessToken:Ve})).then((function(){F(Fe.getState())&&Fe.dispatch({type:m})})),u.a.render(c.a.createElement(i.a,{store:Fe},c.a.createElement(Ye,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[19,1,2]]]);
//# sourceMappingURL=main.3d00f3ae.chunk.js.map